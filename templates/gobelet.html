{% extends "base.html" %}
{% block title %}Gobelet personnalis√©{% endblock %}
{% block content %}
<div class="container gobelet-container">
    <div class="image-box">
        <img alt="Gobelet personnalis√©" src="{{ url_for('static', filename='img/gobelet.jpg') }}">
    </div>

    <div class="form-box">
        <h2>Gobelet personnalis√©</h2>

        {% if strava_connected %}
        <div class="alert alert-success" style="margin-top: 0.5rem;">
            üîó Compte Strava connect√©
        </div>
        {% elif user_has_strava_linked %}
        <div class="alert alert-warning" style="margin-top: 0.5rem;">
            ‚ö†Ô∏è Votre compte Strava est li√©, mais vous devez vous reconnecter.
        </div>
        {% endif %}

        <p class="price">CHF 12.90 ‚Äî TVA incluse</p>
        <p>Ajoutez votre performance ou le trac√© de votre course pour personnaliser votre gobelet.</p>


        <!-- --- Strava / Guest Logic --- -->
        {% if strava_connected %}
        <!-- ‚úÖ Strava activement connect√© -->
        {% if selected_activity %}
        <div class="strava-import-box">
            <h3>‚úÖ Activit√© Strava import√©e</h3>
            <p><b>{{ selected_activity.name }}</b></p>
            <ul>
                <li>Distance : {{ selected_activity.distance }} km</li>
                <li>Temps : {{ selected_activity.time }}</li>
                <li>Allure : {{ selected_activity.pace }}/km</li>
            </ul>
            {% if selected_activity.polyline %}
            <p>Trac√© GPS :</p>
            <img src="{{ url_for('strava.track', activity_id=selected_activity.id) }}"
                 alt="Trac√© GPS" style="max-width:300px; border:1px solid #ccc; border-radius:8px;">
            {% endif %}
            <p style="font-size:0.9em; color:#777;">
                Les champs ci-dessous sont d√©j√† remplis avec vos donn√©es Strava. Vous pouvez les modifier si n√©cessaire.
            </p>
        </div>
        {% else %}
        <div class="choice-box" style="margin-bottom: 20px;">
            <h3>Strava connect√© ‚úÖ</h3>
            <p>Vous pouvez maintenant importer une activit√© :</p>
            <a href="{{ url_for('strava.activities') }}" class="btn btn-primary">Voir mes activit√©s Strava</a>
        </div>
        {% endif %}

        <!-- Bouton d√©connexion Strava -->
        <form action="{{ url_for('strava.disconnect') }}" method="post" style="margin-top:0.5rem;">
            <button type="submit" class="btn btn-danger">D√©connecter Strava</button>
        </form>

        {% else %}
        <!-- üö´ Pas connect√© √† Strava -->
        {% if not strava_just_disconnected %}
        <div class="choice-box" style="margin-bottom: 20px;">
            <h3>Connectez votre compte Strava</h3>
            <form action="{{ url_for('strava.connect') }}" method="get" style="margin-bottom:10px;">
                <button type="submit" style="border:none; background:none; padding:0; cursor:pointer;">
                    <img src="{{ url_for('static', filename='images/btn-strava@1x.png') }}"
                         srcset="{{ url_for('static', filename='images/btn-strava@1x.png') }} 1x,
                                 {{ url_for('static', filename='images/btn-strava@2x.png') }} 2x"
                         alt="Se connecter √† Strava"
                         height="48">
                </button>
            </form>
            <p style="font-size:0.9em; color:#777;">Ou remplissez les champs manuellement ci-dessous.</p>
        </div>
        {% endif %}
        {% endif %}



        <form enctype="multipart/form-data" method="post">
            <label>Couleur</label>
            <select name="color" required>
                <option value="blanc">Blanc</option>
                <option value="noir">Noir</option>
                <option value="bleu">Bleu</option>
                <option value="rouge">Rouge</option>
            </select>

            <label>Quantit√©</label>
            <input min="1" name="qty" required type="number" value="1">

            <fieldset>
                <legend>Performance</legend>
                <label>
                    <input name="add_results" type="checkbox"
                           {% if selected_activity %}checked{% endif %}>
                    Ajouter mes r√©sultats (+CHF 5)
                </label>

                <label>Temps</label>
                <input name="time"
                       value="{{ selected_activity.time if selected_activity else '' }}"
                       pattern="^([0-9]{1,2}:)?[0-5]?[0-9]:[0-5][0-9]$"
                       placeholder="hh:mm:ss"
                       title="Format attendu : hh:mm:ss ou mm:ss"
                       type="text">

                <label>Distance (km)</label>
                <input min="0.01" name="distance" step="0.01"
                       value="{{ selected_activity.distance if selected_activity else '' }}"
                       title="Distance en kilom√®tres (ex: 5.00)"
                       type="number">
            </fieldset>


            <button type="submit">Ajouter au panier</button>
        </form>
    </div>
</div>
{% endblock %}
